################################################################
# NGINX configuration for Delicious Media sites
#

server {
  listen 80;
  listen 443 ssl;
  server_name {vvv_site_name}.test;
  root {vvv_path_to_site}/public_html;

  error_log {vvv_path_to_site}/log/error.log;
  access_log {vvv_path_to_site}/log/access.log;

  ssl_certificate /vagrant/certificates/{vvv_site_name}/dev.crt;
  ssl_certificate_key /vagrant/certificates/{vvv_site_name}/dev.key;

  set $upstream {upstream};

    # rewrite for our WordPress layout
    if (!-e $request_filename) {
        rewrite /wp-admin$ $scheme://$host$uri/ permanent;
        rewrite ^(/[^/]+)?(/wp-.*) /wp/$2 last;
        rewrite ^(/[^/]+)?(/.*\.php) /wp/$2 last;
    }

  include /etc/nginx/nginx-wp-common.conf;
}
